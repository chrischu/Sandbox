<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Development\SolutionInspector\src\SolutionInspector.Configuration\Validation\Static\Validators\XmlNameUniquenessValidator.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Reflection;
using SolutionInspector.Commons.Extensions;
using SolutionInspector.Configuration.Attributes;

namespace SolutionInspector.Configuration.Validation.Static.Validators
{
  internal class XmlNameUniquenessValidator : StaticConfigurationValidatorBase
  {
    private readonly Dictionary&lt;string, List&lt;PropertyInfo&gt;&gt; _xmlAttributeNamesWithProperties = new Dictionary&lt;string, List&lt;PropertyInfo&gt;&gt;();
    private readonly Dictionary&lt;string, List&lt;PropertyInfo&gt;&gt; _xmlElementNamesWithProperties = new Dictionary&lt;string, List&lt;PropertyInfo&gt;&gt;();

    public override void BeginTypeValidation (Type configurationElementType, ReportValidationError reportValidationError)
    {
      _xmlElementNamesWithProperties.Clear();
      _xmlAttributeNamesWithProperties.Clear();
    }

    public override void ValidateValue (PropertyInfo property, ConfigurationValueAttribute attribute, ReportValidationError reportValidationError)
    {
      if (attribute.XmlName != null)
      {
        var list = _xmlAttributeNamesWithProperties.GetOrAdd(attribute.XmlName, key =&gt; new List&lt;PropertyInfo&gt;());
        list.Add(property);
      }
    }

    public override void ValidateSubelement (
      PropertyInfo property,
      ConfigurationSubelementAttribute attribute,
      ReportValidationError reportValidationError)
    {
      if (attribute.XmlName != null)
      {
        var list = _xmlElementNamesWithProperties.GetOrAdd(attribute.XmlName, key =&gt; new List&lt;PropertyInfo&gt;());
        list.Add(property);
      }
    }

    public override void ValidateCollection (
      PropertyInfo property,
      ConfigurationCollectionAttribute attribute,
      ReportValidationError reportValidationError)
    {
      if (attribute.XmlName != null)
      {
        var list = _xmlElementNamesWithProperties.GetOrAdd(attribute.XmlName, key =&gt; new List&lt;PropertyInfo&gt;());
        list.Add(property);
      }
    }

    public override void EndTypeValidation (Type configurationElementType, ReportValidationError reportValidationError)
    {
      var xmlElementNamesWithMultipleProperties = _xmlElementNamesWithProperties.Where(kvp =&gt; kvp.Value.Count &gt; 1);

      foreach (var xmlElementNameWithMultipleProperties in xmlElementNamesWithMultipleProperties)
      foreach (var property in xmlElementNameWithMultipleProperties.Value)
      {
        var properties = xmlElementNameWithMultipleProperties.Value.Where(p =&gt; p.Name != property.Name).ConvertAndJoin(p =&gt; $&quot;&#39;{p.Name}&#39;&quot;, &quot;, &quot;);
        reportValidationError(
          property,
          $&quot;The XML element name &#39;{xmlElementNameWithMultipleProperties.Key}&#39; is not unique (it is duplicated in {properties}).&quot;);
      }

      var xmlAttributeNamesWithMultipleProperties = _xmlAttributeNamesWithProperties.Where(kvp =&gt; kvp.Value.Count &gt; 1);

      foreach (var xmlAttributeNameWithMultipleProperties in xmlAttributeNamesWithMultipleProperties)
      foreach (var property in xmlAttributeNameWithMultipleProperties.Value)
      {
        var properties = xmlAttributeNameWithMultipleProperties.Value.Where(p =&gt; p.Name != property.Name).ConvertAndJoin(p =&gt; $&quot;&#39;{p.Name}&#39;&quot;, &quot;, &quot;);
        reportValidationError(
          property,
          $&quot;The XML attribute name &#39;{xmlAttributeNameWithMultipleProperties.Key}&#39; is not unique (it is duplicated in {properties}).&quot;);
      }
    }
  }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[12,5,12,141,1],[13,5,13,139,1],[17,7,17,46,1],[18,7,18,48,1],[23,7,23,37,1],[25,9,25,88,1],[25,88,25,112,1],[25,112,25,114,1],[25,9,25,114,1],[26,9,26,28,1],[35,7,35,37,1],[37,9,37,86,1],[37,86,37,110,1],[37,110,37,112,1],[37,9,37,112,1],[38,9,38,28,1],[47,7,47,37,1],[49,9,49,86,1],[49,86,49,110,1],[49,110,49,112,1],[49,9,49,112,1],[50,9,50,28,1],[56,7,56,95,1],[56,95,56,114,1],[56,114,56,116,1],[56,7,56,116,1],[58,16,58,56,1],[58,57,58,59,1],[58,60,58,97,1],[59,16,59,28,1],[59,29,59,31,1],[59,32,59,74,1],[61,9,61,80,1],[61,80,61,103,1],[61,103,61,125,1],[61,125,61,138,1],[61,138,61,146,1],[61,9,61,146,1],[62,9,64,131,1],[67,7,67,99,1],[67,99,67,118,1],[67,118,67,120,1],[67,7,67,120,1],[69,16,69,58,1],[69,59,69,61,1],[69,62,69,101,1],[70,16,70,28,1],[70,29,70,31,1],[70,32,70,76,1],[72,9,72,82,1],[72,82,72,105,1],[72,105,72,127,1],[72,127,72,140,1],[72,140,72,148,1],[72,9,72,148,1],[73,9,75,135,1]]);
    </script>
  </body>
</html>