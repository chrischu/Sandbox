<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Development\SolutionInspector\src\SolutionInspector.Internals\ObjectModel\ProjectItem.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Text;
using JetBrains.Annotations;
using SolutionInspector.Api.ObjectModel;
using SolutionInspector.Commons.Extensions;
using Wrapperator.Interfaces.IO;
using Wrapperator.Wrappers;

namespace SolutionInspector.Internals.ObjectModel
{
  internal class ProjectItem : IProjectItem
  {
    private readonly List&lt;ProjectItem&gt; _children = new List&lt;ProjectItem&gt;();
    private readonly Lazy&lt;string&gt; _identifier;

    protected ProjectItem(
      IProject project,
      Microsoft.Build.Evaluation.ProjectItem msBuildProjectItem)
    {
      Project = project;
      OriginalProjectItem = msBuildProjectItem;

      Include = new ProjectItemInclude(msBuildProjectItem.EvaluatedInclude, msBuildProjectItem.UnevaluatedInclude);

      BuildAction = ProjectItemBuildAction.Custom(msBuildProjectItem.ItemType);
      var fullPath = Path.GetFullPath(Path.Combine(project.ProjectFile.DirectoryName, msBuildProjectItem.EvaluatedInclude));
      File = Wrapper.Wrap(new FileInfo(fullPath));

      Location = new ProjectLocation(msBuildProjectItem.Xml.Location.Line, msBuildProjectItem.Xml.Location.Column);
      Metadata = msBuildProjectItem.Metadata.ToDictionary(m =&gt; m.Name, m =&gt; m.EvaluatedValue);
      IsLink = Metadata.ContainsKey(&quot;Link&quot;);

      if (msBuildProjectItem.UnevaluatedInclude.Contains(&quot;*&quot;))
      {
        IsIncludedByWildcard = true;
        WildcardInclude = msBuildProjectItem.UnevaluatedInclude;
        WildcardExclude = msBuildProjectItem.Xml.Exclude;
      }

      _identifier = new Lazy&lt;string&gt;(CreateIdentifier);
    }

    public Microsoft.Build.Evaluation.ProjectItem OriginalProjectItem { get; set; }

    public IProject Project { get; }

    public string Name =&gt; Path.GetFileName(Include.Evaluated);

    public string Identifier =&gt; _identifier.Value;

    public string FullPath =&gt; File.FullName;

    public IProjectItemInclude Include { get; }

    public ProjectItemBuildAction BuildAction { get; }

    public IFileInfo File { get; }
    public bool IsLink { get; }
    public bool IsIncludedByWildcard { get; }

    [CanBeNull]
    public string WildcardInclude { get; }

    [CanBeNull]
    public string WildcardExclude { get; }

    public IProjectLocation Location { get; }

    public IReadOnlyDictionary&lt;string, string&gt; Metadata { get; }

    [CanBeNull]
    public string CustomTool =&gt; Metadata.GetValueOrDefault(&quot;Generator&quot;);

    [CanBeNull]
    public string CustomToolNamespace =&gt; Metadata.GetValueOrDefault(&quot;CustomToolNamespace&quot;);

    public IProjectItem Parent { get; private set; }

    public IReadOnlyCollection&lt;IProjectItem&gt; Children =&gt; _children;

    private string CreateIdentifier()
    {
      var sb = new StringBuilder();

      sb.Append(Parent != null ? Parent.Identifier : Project.Identifier);
      sb.Append(&#39;/&#39;);

      var include = IsLink ? Metadata[&quot;Link&quot;] : Include.Evaluated;

      include = include.Replace(&#39;\\&#39;, &#39;/&#39;);
      if (Parent != null)
        include = include.Split(&#39;/&#39;).Last();

      sb.Append(include);

      return sb.ToString();
    }

    internal void SetParent(ProjectItem parent)
    {
      parent._children.Add(this);
      Parent = parent;
    }

    public static ProjectItem FromMsBuildProjectItem(IProject project, Microsoft.Build.Evaluation.ProjectItem msBuildProjectItem)
    {
      return new ProjectItem(project, msBuildProjectItem);
    }
  }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[16,5,16,76,1],[19,5,21,65,1],[23,7,23,25,1],[24,7,24,48,1],[26,7,26,116,1],[28,7,28,80,1],[29,7,29,125,1],[30,7,30,51,1],[32,7,32,116,1],[33,7,33,64,1],[33,64,33,70,1],[33,70,33,77,1],[33,77,33,93,1],[33,93,33,95,1],[33,7,33,95,1],[34,7,34,45,1],[36,7,36,63,1],[38,9,38,37,1],[39,9,39,65,1],[40,9,40,58,1],[43,7,43,56,1],[50,27,50,62,1],[52,33,52,50,1],[54,31,54,44,1],[75,33,75,72,1],[78,42,78,91,1],[82,58,82,67,1],[86,7,86,36,1],[88,7,88,74,1],[89,7,89,22,1],[91,7,91,67,1],[93,7,93,44,1],[94,7,94,26,1],[95,9,95,45,1],[97,7,97,26,1],[99,7,99,28,1],[104,7,104,34,1],[105,7,105,23,1],[110,7,110,59,1]]);
    </script>
  </body>
</html>