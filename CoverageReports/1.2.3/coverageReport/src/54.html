<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Development\SolutionInspector\src\SolutionInspector.Configuration\Collections\ConfigurationElementCollectionBase.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections;
using System.Collections.Generic;
using System.Diagnostics.CodeAnalysis;
using System.Linq;
using System.Xml.Linq;
using JetBrains.Annotations;

namespace SolutionInspector.Configuration.Collections
{
  internal abstract class ConfigurationElementCollectionBase&lt;TElement&gt; : IConfigurationElementCollectionBase&lt;TElement&gt;
      where TElement : ConfigurationElement
  {
    private readonly XElement _collectionElement;
    private readonly List&lt;TElement&gt; _items;

    protected ConfigurationElementCollectionBase (XElement collectionElement, IEnumerable&lt;TElement&gt; elements)
    {
      _collectionElement = collectionElement;

      ContainingDocument = _collectionElement.Document;
      if (ContainingDocument == null)
        throw new ArgumentException(&quot;The collection element is not attached to a document.&quot;, nameof(collectionElement));

      _items = elements.ToList();
    }

    protected XDocument ContainingDocument { get; }

    public int Count =&gt; _items.Count;

    [ExcludeFromCodeCoverage]
    public bool IsReadOnly =&gt; false;

    public TElement this [int index]
    {
      get =&gt; _items[index];
      set
      {
        ValidateNewElement(value);
        _items[index] = value;
      }
    }

    public IEnumerator&lt;TElement&gt; GetEnumerator ()
    {
      return _items.GetEnumerator();
    }

    [ExcludeFromCodeCoverage]
    IEnumerator IEnumerable.GetEnumerator ()
    {
      return GetEnumerator();
    }

    public void Add ([CanBeNull] TElement element)
    {
      Insert(_items.Count, element);
    }

    public void Insert (int index, [CanBeNull] TElement element)
    {
      if (element == null)
        throw new ArgumentNullException(nameof(element));

      ValidateNewElement(element);

      _items.Insert(index, element);
      _collectionElement.Add(element.Element);
    }

    public void Clear ()
    {
      _items.Clear();
      _collectionElement.RemoveNodes();
    }

    [ExcludeFromCodeCoverage]
    public bool Contains ([CanBeNull] TElement item)
    {
      return _items.Contains(item);
    }

    [ExcludeFromCodeCoverage]
    public void CopyTo (TElement[] array, int arrayIndex)
    {
      _items.CopyTo(array, arrayIndex);
    }

    public bool Remove ([CanBeNull] TElement element)
    {
      if (element == null)
        throw new ArgumentNullException(nameof(element));

      var removed = _items.Remove(element);
      if (removed)
        element.Element.Remove();

      return removed;
    }

    public void RemoveAt (int index)
    {
      var element = _items[index];
      _items.RemoveAt(index);
      element.Element.Remove();
    }

    [ExcludeFromCodeCoverage]
    public int IndexOf ([CanBeNull] TElement item)
    {
      return _items.IndexOf(item);
    }

    protected virtual void ValidateNewElement (TElement element)
    {
    }
  }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[17,5,17,110,1],[19,7,19,46,1],[21,7,21,56,1],[22,7,22,38,1],[23,9,23,121,1],[25,7,25,34,1],[30,25,30,37,1],[37,14,37,27,1],[40,9,40,35,1],[41,9,41,31,1],[47,7,47,37,1],[58,7,58,37,1],[63,7,63,27,1],[64,9,64,58,1],[66,7,66,35,1],[68,7,68,37,1],[69,7,69,47,1],[74,7,74,22,1],[75,7,75,40,1],[92,7,92,27,1],[93,9,93,58,1],[95,7,95,44,1],[96,7,96,19,1],[97,9,97,34,1],[99,7,99,22,1],[104,7,104,35,1],[105,7,105,30,1],[106,7,106,32,1]]);
    </script>
  </body>
</html>